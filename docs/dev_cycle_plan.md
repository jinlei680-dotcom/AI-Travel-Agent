# AI Travel Planner 开发周期计划（Web + Java 后端）

本计划用于指导项目从立项到发布的端到端迭代，涵盖阶段划分、时间安排、交付物、验收标准、风险与资源安排。面向“Web 版 AI 旅行规划师”，前端建议 Next.js，后端采用 Spring Boot（WebFlux 优先）。

## 概述
- 项目目标：语音优先的旅行规划体验；AI 生成可执行行程；费用预算与语音记账；账户与云端同步；地图为中心的交互。
- 技术栈（推荐）：
  - 前端：Next.js + TypeScript + Tailwind + 高德地图 JS SDK
  - 后端：Java 21 + Spring Boot 3 + WebFlux + Spring Security
  - 数据：PostgreSQL（R2DBC 或 JPA）+ Redis（缓存/限流）+ S3/MinIO（音频/图片）
  - AI/语音/地图：Qwen/OpenAI（可路由）、科大讯飞 STT、高德地图 REST
  - 观测：Micrometer + Prometheus + Grafana，错误上报 Sentry
- 发布：Docker 容器化；云主机/K8s；CD 持续部署；国内可用阿里云/腾讯云。
- 假设：
  - 目标市场以中文为主，中英双语可选。
  - 先不接真实预订接口（酒店/交通），以建议与外链为主。
  - 成本控制与流式体验优先。

## 时间线与阶段（建议 12 周）
- P0 立项与需求对齐（第 0–0.5 周）
- Sprint 1 基础设施与框架搭建（第 1–2 周）
- Sprint 2 MVP：行程生成与地图展示（第 3–4 周）
- Sprint 3 预算与语音记账（第 5–6 周）
- Sprint 4 编辑与实时同步（第 7–8 周）
- Sprint 5 分享与导出（第 9–10 周）
- Sprint 6 质量与安全加固（第 11 周）
- 发布与复盘（第 12 周）

## 阶段目标与交付物

### P0 立项与需求对齐（0–0.5 周）
- 目标：明确范围、优先级、技术选型与成本边界。
- 关键任务：
  - 输出架构与接口契约文档（已完成 `docs/architecture_api_contracts.md`）。
  - 明确供应商组合（讯飞 + 高德 + Qwen/OpenAI）。
  - 制定域名、环境与密钥管理策略。
- 交付物：PRD 摘要、架构图、API 契约、里程碑排期。
- 验收标准：文档评审通过；风险登记表创建。

### Sprint 1 基础设施与框架搭建（1–2 周）
- 目标：打通最小后端与前端框架，建立 CI/CD 与环境。
- 关键任务：
  - 仓库初始化、分支策略（main/dev）与 CI（lint/test/build）。
  - 后端骨架：Spring Boot 项目、WebFlux 路由、JWT 鉴权、异常与日志基线。
  - 数据库建模：users/profiles/plans/days/activities/expenses 基础表与迁移。
  - Redis 缓存与速率限制中间件（示例在 `/poi/search`）。
  - 对象存储对接（S3/MinIO），上传签名与生命周期策略。
  - 前端：Next.js 项目初始化，地图 SDK 注入，基础 UI 框架（Tailwind / shadcn）。
  - Dev/Stage/Prod 环境与 Secrets 管理（.env + 管理平台）。
- 交付物：可运行的基础服务与页面；数据库迁移脚本；CI/CD 流程。
- 验收标准：基础接口健康检查通过；部署到测试环境可访问。

### Sprint 2 MVP：行程生成与地图展示（3–4 周）
- 目标：基于用户约束生成行程草案并呈现地图视图。
- 关键任务：
  - `/plans/generate` 编排：POI 检索 → LLM 草案 → 预算初检 → JSON 校验。
  - LLMProvider 抽象与流式（SSE）输出；国内外模型路由策略。
  - MapProvider：高德 POI/路线封装；服务端缓存；前端地图联动展示。
  - 前端页面：行程列表、行程详情（天/活动卡片 + 地图动线）。
  - 基础用户登录注册与权限校验（JWT）。
- 交付物：首版可用行程生成体验（无费用细项）。
- 验收标准：端到端 Demo；核心流程契约测试与集成测试通过。

### Sprint 3 预算与语音记账（5–6 周）
- 目标：估算预算并实现语音记账与汇总展示。
- 关键任务：
  - `/expenses` 手动记账 API 与前端录入界面。
  - `/expenses/voice`：语音识别 → 意图解析 → 分类与金额抽取 → 入库。
  - 预算估算器：目的地均价 + 行程结构生成基线预算；预算条与分类汇总视图。
  - 汇率支持与币种展示（简版）。
- 交付物：费用管理页面与图表；语音记账流程。
- 验收标准：语音记账在安静环境下识别成功率 ≥ 90%；预算估算结果可解释。

### Sprint 4 编辑与实时同步（7–8 周）
- 目标：日程编辑器与地图动线联动，数据实时同步。
- 关键任务：
  - `/plans/{id}/days/{day}/replan` 增量重算；保障整体稳定与最小范围更新。
  - 前端日程编辑器：拖拽重排、替换建议、时间段调整，与地图联动高亮。
  - Realtime（WebSocket/SSE 或 Supabase Realtime 替代）：多设备同步与冲突处理。
  - 草稿/已发布状态与版本对比视图。
- 交付物：可编辑的行程与同步能力。
- 验收标准：并发编辑稳定；冲突提示与解决策略可用；核心指标监控上线。

### Sprint 5 分享与导出（9–10 周）
- 目标：计划分享与导出 PDF/.ics，异步队列支撑长任务。
- 关键任务：
  - 分享链接：只读与协作权限控制；访问日志与撤销分享。
  - 导出服务：`/plans/{id}/export` → 队列 → 生成 → 下载；模板美化。
  - 队列与重试：Kafka/RabbitMQ；作业状态查询接口。
- 交付物：分享页面与导出文件下载。
- 验收标准：平均导出时间 < 30s；失败可重试与告警；权限正确生效。

### Sprint 6 质量与安全加固（11 周）
- 目标：稳定性、性能、安全与合规完善。
- 关键任务：
  - 负载与熔断测试：LLM/地图/语音 API 高峰期表现；降级与缓存命中率优化。
  - 安全加固：速率限制、XSS/CSRF、提示注入防护；日志审计与隐私策略完善。
  - 观测体系：指标阈值与告警配置；错误上报完善；成本监控仪表盘。
- 交付物：测试报告、风险清单、修复记录。
- 验收标准：SLO 达标（错误率、延迟）；安全扫描无高危漏洞。

### 发布与复盘（12 周）
- 目标：上线与回滚方案准备，复盘与后续路线图。
- 关键任务：
  - 发布清单与灰度策略；域名与证书；备份与回滚验证。
  - 用户文档与隐私政策；反馈渠道与支持流程。
  - 项目复盘与改进列表；下一阶段规划（协作模式、PWA、通知与当天导航辅助）。
- 交付物：发布清单、复盘报告、路线图 v2。
- 验收标准：顺利发布；关键指标稳定；用户反馈收集机制到位。

## 里程碑与评审节奏
- 每次 Sprint 结束进行里程碑评审（Demo + 指标 + 风险）。
- 每周例会：进度、阻塞与风险；每日 Standup（可选）。
- 关键评审节点：MVP 完成（第 4 周）、预算与记账（第 6 周）、同步与编辑（第 8 周）、导出与分享（第 10 周）、上线（第 12 周）。

## 资源与角色分工（示例）
- 产品/项目：1（PRD、优先级、验收）
- 前端工程：1–2（页面与地图交互、SSE、语音入口）
- 后端工程（Java）：1–2（编排、Provider 接入、数据层）
- 设计：1（地图与行程体验、视觉与导出模板）
- QA：1（契约与集成测试、负载与安全）

## 风险与缓解策略
- LLM 成本与延迟：分段生成、去重与缓存、国内模型路由优化。
- 地图/POI一致性：开放时间/价格差异，允许手动校正与免责声明。
- 语音识别鲁棒性：嘈杂环境与方言，提供重述提示与关键字段二次确认。
- API 配额与稳定性：配额监控与备用 Provider；本地缓存与降级路径。
- 合规与隐私：音频最小化存储与到期清理；明确用户同意与政策。

## 验收标准（统一维度）
- 功能：接口契约稳定；核心路径端到端通过。
- 质量：错误率 < 1%，P95 接口延迟满足阶段目标。
- 安全：鉴权严格、权限正确、日志审计完整。
- 用户体验：地图联动流畅；流式反馈及时；预算与记账易用可解释。

## 环境与配置
- 分环境：dev/stage/prod；独立 Secrets 与数据库。
- 观测：日志聚合、指标与告警；Sentry 错误上报。
- 部署：CI/CD 自动化与回滚；蓝绿/灰度策略。

## 后续路线图（v2+）
- 协作模式（家庭/团队权限与评论）。
- PWA 与离线能力（缓存、离线编辑与同步）。
- 导航辅助与当天提醒（基于位置与时间）。
- 更多供应商接入（百度地图、其他 LLM/语音）。

---
本文档为迭代计划基线，后续可根据实际进度与资源进行滚动调整与复盘优化。